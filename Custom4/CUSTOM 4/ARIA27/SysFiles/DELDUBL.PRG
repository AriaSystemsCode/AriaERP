USE SYREPUVR IN 0 ALIAS FILE1 SHARED
SELECT FILE1
*SET ORDER TO 3 DESCENDING
SET ORDER TO 3

USE SYREPUVR IN 0 ALIAS FILE2 AGAIN SHARED
SELECT FILE2
*SET ORDER TO 3 DESCENDING
SET ORDER TO 3

USE SYBACKUP IN 0 SHARED

SELECT FILE1
LOCATE
SCAN FOR CUPGRDLVL # 'U'
  LCKEY = EVALUATE(KEY())
  WAIT WINDOW LCKEY NOWAIT
  LNRECNO = RECNO()
  LCKEY2 = crep_id+cexptype+STR(nvarpos)
  LCSUPEXPR = MSUPEXPR
  LCDATA_DEF = MDATA_DEF
  IF SEEK(LCKEY,'FILE2')
    SELECT FILE2
    SCAN REST WHILE crep_id+PADR(SUBSTR(mfld_name,1,100),100," ") = LCKEY;
                FOR RECNO() # LNRECNO .AND. crep_id+cexptype+STR(nvarpos) = LCKEY2 .AND.;
                    MSUPEXPR = LCSUPEXPR .AND. MDATA_DEF = LCDATA_DEF
      SCATTER MEMO MEMVAR
      INSERT INTO SYBACKUP FROM MEMVAR
      DELETE
    ENDSCAN
  ENDIF
ENDSCAN
WAIT CLEAR
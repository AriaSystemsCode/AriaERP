* Alena

* Purchase Order Docket

* 06/08/99

* Author: Steve Harper

DIME ARRFAB(16)
DIME ARRWID(16)
DIME ARRDES(16)
DIME ARRCOL(16)
DIME ARRSTY(16)
DIME ARRCOS(16)
DIME ARRSUP(16)
DIME ARRREQ(16)
STORE ' ' TO ARRFAB, ARRWID, ARRDES, ARRCOL, ARRSTY, ARRCOS, ARRSUP, ARRREQ
*on error do sfherror with error( ), message( ), program( ), lineno( )

IF .NOT. USED('SYCMENU')
	SELECT 0
	USE (gcSysHome + 'SYCMENU')
	SET ORDER TO 1
ENDIF


SELECT POSHDR 
SET ORDER TO POSHDR
SELECT APVENDOR
SET ORDER TO VENCODE
SELECT STYLE 
SET ORDER TO STYLE
SELECT CUTPICK
SET ORDER TO CUTPICK
SELECT ORDHDR
SET ORDER TO ORDHDR
SELE WAREHOUS
SET ORDER TO WAREHOUS
IF .NOT. USED('SCALE')
	SELE 0
	USE(gcdatadir + 'SCALE')
ENDIF
SELECT SCALE
SET ORDER TO SCALE

IF .NOT. USED('MATINVJL')
    SELE 0
    USE(gcdatadir + 'MATINVJL')
ENDIF     
***SET ORDER TO MATINVJL

IF .NOT. USED('BOM')
	SELE 0
	USE(gcdatadir + 'BOM')
ENDIF
SELECT BOM
SET ORDER TO 2

IF .NOT. USED('BOMLINE')
	SELE 0
	USE(gcdatadir + 'BOMLINE')
ENDIF
SELECT BOMLINE

*C037144,1 08/24/2003 AMH [Start]
*SET ORDER TO BOMLINE
SET ORDER TO MFGOPR
*C037144,1 08/24/2003 AMH [End]

IF .NOT. USED('CUSTOMER')
	SELE 0
	USE(gcdatadir + 'CUSTOMER')
ENDIF
SELECT CUSTOMER
SET ORDER TO CUSTOMER

IF .NOT. USED('ICISTRU')
	SELE 0
	USE(gcdatadir + 'ICISTRU')
ENDIF
SELECT ICISTRU
SET ORDER TO SEGNO

IF .NOT. USED('FABRIC')
	SELE 0
	USE(gcdatadir + 'FABRIC')
ENDIF
SELECT FABRIC
SET ORDER TO FABRIC

IF .NOT. USED('CODES')
	SELE 0
	USE(gcdatadir + 'CODES')
ENDIF
SELECT CODES
SET ORDER TO CODES

IF .NOT. USED('ORDLINE')
	SELE 0
	USE(gcdatadir + 'ORDLINE')
ENDIF
SELECT ORDLINE
SET ORDER TO ORDLINE

IF .NOT. USED('POFHDR')
	SELE 0
	USE(gcdatadir + 'POFHDR')
ENDIF
SELECT POFHDR
SET ORDER TO POFHDR

IF .NOT. USED('NOTEPAD')
	SELE 0
	USE(gcdatadir + 'NOTEPAD')
ENDIF
SELECT NOTEPAD
SET ORDER TO NOTEPAD

IF .NOT. USED('OBJLINK')
	SELE 0
	USE(gcdatadir + 'OBJLINK')
ENDIF
SELECT OBJLINK
SET ORDER TO OBJLNKTY

IF .NOT. USED('OBJECTS')
	SELE 0
	USE(gcdatadir + 'OBJECTS')
ENDIF
SELECT OBJECTS
SET ORDER TO Objectid

IF .NOT. USED('FABDYE')
	SELE 0
	USE(gcdatadir + 'FABDYE')
ENDIF
SELECT FABDYE
SET ORDER TO FABDYEW

IF .NOT. USED('POFLN')
	SELE 0
	USE(gcdatadir + 'POFLN')
ENDIF
SELECT POFLN
SET ORDER TO POFLNF
SET RELATION TO CMATTYPE+POMAT INTO POFHDR ADDITIVE

SELE POSLN
SET ORDER TO POSLN

SELECT CUTPICK
SET RELATION TO 'O'+ORDER INTO ORDHDR ADDITIVE

*SET RELATION TO 'O'+ORDER+CORDLINE INTO ORDLINE

STORE 0 TO LNCOLORLEN, LNSTYLEMAJ
SELE ICISTRU
IF SEEK('U1')
	STORE NISEGSIZE TO LNSTYLEMAJ
ENDIF
IF SEEK('U2')
	STORE NISEGSIZE TO LNCOLORLEN
ENDIF

YFILTER = ' '
IF AT('POSHDR.PO',LCRPEXP) > 0
	YFILTER = STRTRAN(LCRPEXP,'POSHDR.PO','BOMLINE.CTKTNO')
ENDIF

 
SELECT BOMLINE
GO TOP
XFILTER = "CCATGTYP $ 'F'"
IF .NOT. EMPTY(YFILTER)
	XFILTER = XFILTER + ' .AND. '+YFILTER
ENDIF	

*SELECT ITEM,CUTTKT,ICLR,UNTQTY,REQ_QTY,CWARECODE FROM CTKTBOM INTO CURSOR TEMP WHERE &XFILTER

DIMENSION LATEMP(14,4)
LATEMP(1,1) = 'DADD_DATE'
LATEMP(1,2) = 'D'
LATEMP(1,3) = '10'
LATEMP(1,4) = '0'
LATEMP(2,1) = 'CADD_TIME'
LATEMP(2,2) = 'C'
LATEMP(2,3) = '11'
LATEMP(2,4) = '0'
LATEMP(3,1) = 'ITEM'
LATEMP(3,2) = 'C'
LATEMP(3,3) = '19'
LATEMP(3,4) = '0'
LATEMP(4,1) = 'CUTTKT'
LATEMP(4,2) = 'C'
LATEMP(4,3) = '6'
LATEMP(4,4) = '0'
LATEMP(5,1) = 'ICLR'
LATEMP(5,2) = 'C'
LATEMP(5,3) = '6'
LATEMP(5,4) = '0'
LATEMP(6,1) = 'UNTQTY'
LATEMP(6,2) = 'N'
LATEMP(6,3) = '7'
LATEMP(6,4) = '3'
LATEMP(7,1) = 'REQ_QTY'
LATEMP(7,2) = 'N'
LATEMP(7,3) = '12'
LATEMP(7,4) = '3'
LATEMP(8,1) = 'TYP'
LATEMP(8,2) = 'C'
LATEMP(8,3) = '11'
LATEMP(8,4) = '0'
LATEMP(9,1) = 'CWARECODE'
LATEMP(9,2) = 'C'
LATEMP(9,3) = '6'
LATEMP(9,4) = '0'
LATEMP(10,1) = 'ISSUE_QTY'
LATEMP(10,2) = 'N'
LATEMP(10,3) = '12'
LATEMP(10,4) = '3'
LATEMP(11,1) = 'CPVENDOR'
LATEMP(11,2) = 'C'
LATEMP(11,3) = '8'
LATEMP(11,4) = '0'
LATEMP(12,1) = 'CPMATPO'
LATEMP(12,2) = 'C'
LATEMP(12,3) = '6'
LATEMP(12,4) = '0'
LATEMP(13,1) = 'EXTRA'
LATEMP(13,2) = 'C'
LATEMP(13,3) = '6'
LATEMP(13,4) = '0'
LATEMP(14,1) = 'BULK'
LATEMP(14,2) = 'C'
LATEMP(14,3) = '6'
LATEMP(14,4) = '0'
CREA CURSOR TEMP FROM ARRAY LATEMP
INDEX ON DTOS(DADD_DATE)+CADD_TIME TAG DATI ADDITIVE
 
*C037144,1 08/24/2003 AMH [Start]
lcPOsFile = ''
llPOsRang = .F.

lnPosition = ASUBSCRIPT(laOGFxFlt,ASCAN(laOGFxFlt,'POSHDR.PO'),1)
IF lnPosition > 0
  lcPOsFile = laOGFxFlt[lnPosition,6]
  llPOsRang = (!EMPTY(lcPOsFile) .AND. USED(lcPOsFile) .AND. RECCOUNT(lcPOsFile)>0)
ENDIF

IF llPOsRang
  SELECT (lcPOsFile)
  SCAN
    IF SEEK('I'+PO,'BOMLINE')
      SELECT BOMLINE
      SCAN REST WHILE CIMTYP+CTKTNO = 'I'+EVALUATE(lcPOsFile+'.PO') FOR CCATGTYP = 'F'
        SELE TEMP
        APPE BLAN
        REPL TYP WITH BOMLINE.CTYPE, ITEM WITH BOMLINE.ITEM, CUTTKT WITH BOMLINE.CTKTNO, ICLR WITH BOMLINE.ICLR, ;
             UNTQTY WITH BOMLINE.UNITQTY, REQ_QTY WITH BOMLINE.ITEMQTY 
        REPL EXTRA WITH ' '
        SELE STYLE
        IF SEEK(BOMLINE.STYLE) 
          REPL TEMP.EXTRA WITH LOCATION
        ENDIF
        STORE ' ' TO LCWARECODE, LCSESSION
        SELE MATINVJL
        SET ORDER TO MATINVJL
        IF SEEK(LEFT(BOMLINE.ITEM,7)+BOMLINE.ICLR,'MATINVJL')
          SCAN REST FOR MATINVJL.CTRANTYPE='4' .AND. MATINVJL.CTRAN=BOMLINE.CTKTNO WHILE CFABRIC+CCOLOR+CWARECODE+CDYELOT+CRSESSION+CISESSION=LEFT(BOMLINE.ITEM,7)+BOMLINE.ICLR
            SELE TEMP
            REPLACE CWARECODE WITH MATINVJL.CWARECODE
            LCSESSION = MATINVJL.CRSESSION
            SELE MATINVJL
            LCMAPONO = " "
            IF SEEK(LEFT(BOMLINE.ITEM,7)+BOMLINE.ICLR+MATINVJL.CWARECODE,'MATINVJL')
              SCAN REST FOR CTRANTYPE='1' .AND. CRSESSION==MATINVJL.CRSESSION WHILE CFABRIC+CCOLOR+CWARECODE+CDYELOT+CRSESSION+CISESSION=LEFT(BOMLINE.ITEM,7)+BOMLINE.ICLR+MATINVJL.CWARECODE
                LCMAPONO = MATINVJL.CTRAN
                SELECT POFHDR
                IF SEEK('P'+LCMAPONO)
                  SELE TEMP 
                  IF MATINVJL.CRSESSION=LCSESSION
                    REPLACE CPVENDOR WITH POFHDR.VENDOR
                    REPL CPMATPO WITH MATINVJL.CTRAN
                  ENDIF
                ENDIF
              ENDSCAN
            ENDIF
          ENDSCAN 
        ENDIF
        STORE ' ' TO LCSTYLE
        SELE POSLN
        IF SEEK('P'+BOMLINE.CTKTNO)
          STORE SUBSTR(STYLE,1,LNSTYLEMAJ) TO LCSTYLE	
        ENDIF
        SELE BOMLINE
      ENDSCAN
    ENDIF
  ENDSCAN
ELSE
*C037144,1 08/24/2003 AMH [End]

SELE BOMLINE
SCAN FOR &XFILTER
   	SELE TEMP
	APPE BLAN
	REPL TYP WITH BOMLINE.CTYPE, ITEM WITH BOMLINE.ITEM, CUTTKT WITH BOMLINE.CTKTNO, ICLR WITH BOMLINE.ICLR, ;
		UNTQTY WITH BOMLINE.UNITQTY, REQ_QTY WITH BOMLINE.ITEMQTY 
**    REPL ISSUE_QTY WITH 999.99
    REPL EXTRA WITH ' '
    SELE STYLE
    IF SEEK(BOMLINE.STYLE) 
     REPL TEMP.EXTRA WITH LOCATION
    ENDIF
    STORE ' ' TO LCWARECODE, LCSESSION
    SELE MATINVJL
    SET ORDER TO MATINVJL
    IF SEEK(LEFT(BOMLINE.ITEM,7)+BOMLINE.ICLR,'MATINVJL')
     SCAN REST FOR MATINVJL.CTRANTYPE='4' .AND. MATINVJL.CTRAN=BOMLINE.CTKTNO WHILE CFABRIC+CCOLOR+CWARECODE+CDYELOT+CRSESSION+CISESSION=LEFT(BOMLINE.ITEM,7)+BOMLINE.ICLR
      SELE TEMP
      REPLACE CWARECODE WITH MATINVJL.CWARECODE
      LCSESSION = MATINVJL.CRSESSION
      SELE MATINVJL
      LCMAPONO = " "
      IF SEEK(LEFT(BOMLINE.ITEM,7)+BOMLINE.ICLR+MATINVJL.CWARECODE,'MATINVJL')
       SCAN REST FOR CTRANTYPE='1' .AND. CRSESSION==MATINVJL.CRSESSION WHILE CFABRIC+CCOLOR+CWARECODE+CDYELOT+CRSESSION+CISESSION=LEFT(BOMLINE.ITEM,7)+BOMLINE.ICLR+MATINVJL.CWARECODE
       LCMAPONO = MATINVJL.CTRAN
       SELECT POFHDR
       IF SEEK('P'+LCMAPONO)
        SELE TEMP 
        IF MATINVJL.CRSESSION=LCSESSION
         REPLACE CPVENDOR WITH POFHDR.VENDOR
         REPL CPMATPO WITH MATINVJL.CTRAN
        ENDIF
       ENDIF
       ENDSCAN
      ENDIF
     ENDSCAN 
    ENDIF
	STORE ' ' TO LCSTYLE
	SELE POSLN
	IF SEEK('P'+BOMLINE.CTKTNO)
		STORE SUBSTR(STYLE,1,LNSTYLEMAJ) TO LCSTYLE	
	ENDIF
	SELE BOMLINE
ENDSCAN 

*C037144,1 08/24/2003 AMH [Start]
ENDIF
*C037144,1 08/24/2003 AMH [End]

SELE CTKTBOM
SET ORDER TO CTKTBOM
SELE TEMP
GO TOP
CHKITEM = " "
SCAN
IF CHKITEM <> TEMP.ITEM+TEMP.ICLR+TEMP.CUTTKT
 CHKITEM=TEMP.ITEM+TEMP.ICLR+TEMP.CUTTKT
 SELE CTKTBOM 
 IF SEEK('I'+TEMP.CUTTKT+'2'+TEMP.ITEM+TEMP.ICLR)
  REPL TEMP.ISSUE_QTY WITH CTKTBOM.USED_QTY
  IF TEMP.EXTRA = 'BULK'
   REPL TEMP.REQ_QTY WITH CTKTBOM.REQ_QTY
  ENDIF
 ENDIF  
ENDIF
SELE TEMP
IF TEMP.EXTRA = 'EXTRA'
 DELE
 ENDIF 
ENDSCAN

DIMENSION LAFIELDS(177,4)
LAFIELDS(1,1) = 'PO'
LAFIELDS(1,2) = 'C'
LAFIELDS(1,3) = '6'
LAFIELDS(1,4) = '0'

LAFIELDS(2,1) = 'FIELDA1'
LAFIELDS(2,2) = 'C'
LAFIELDS(2,3) = '8'
LAFIELDS(2,4) = '0'
LAFIELDS(3,1) = 'FIELDA2'
LAFIELDS(3,2) = 'C'
LAFIELDS(3,3) = '8'
LAFIELDS(3,4) = '0'
LAFIELDS(4,1) = 'FIELDA3'
LAFIELDS(4,2) = 'C'
LAFIELDS(4,3) = '8'
LAFIELDS(4,4) = '0'
LAFIELDS(5,1) = 'FIELDA4'
LAFIELDS(5,2) = 'C'
LAFIELDS(5,3) = '8'
LAFIELDS(5,4) = '0'
LAFIELDS(6,1) = 'FIELDA5'
LAFIELDS(6,2) = 'C'
LAFIELDS(6,3) = '8'
LAFIELDS(6,4) = '0'
LAFIELDS(7,1) = 'FIELDA6'
LAFIELDS(7,2) = 'C'
LAFIELDS(7,3) = '8'
LAFIELDS(7,4) = '0'
LAFIELDS(8,1) = 'FIELDA7'
LAFIELDS(8,2) = 'C'
LAFIELDS(8,3) = '8'
LAFIELDS(8,4) = '0'
LAFIELDS(9,1) = 'FIELDA8'
LAFIELDS(9,2) = 'C'
LAFIELDS(9,3) = '8'
LAFIELDS(9,4) = '0'
LAFIELDS(10,1) = 'FIELDA9'
LAFIELDS(10,2) = 'C'
LAFIELDS(10,3) = '8'
LAFIELDS(10,4) = '0'
LAFIELDS(11,1) = 'FIELDA10'
LAFIELDS(11,2) = 'C'
LAFIELDS(11,3) = '8'
LAFIELDS(11,4) = '0'
LAFIELDS(12,1) = 'FIELDA11'
LAFIELDS(12,2) = 'C'
LAFIELDS(12,3) = '8'
LAFIELDS(12,4) = '0'
LAFIELDS(13,1) = 'FIELDA12'
LAFIELDS(13,2) = 'C'
LAFIELDS(13,3) = '8'
LAFIELDS(13,4) = '0'
LAFIELDS(14,1) = 'FIELDA13'
LAFIELDS(14,2) = 'C'
LAFIELDS(14,3) = '8'
LAFIELDS(14,4) = '0'
LAFIELDS(15,1) = 'FIELDA14'
LAFIELDS(15,2) = 'C'
LAFIELDS(15,3) = '8'
LAFIELDS(15,4) = '0'
LAFIELDS(16,1) = 'FIELDA15'
LAFIELDS(16,2) = 'C'
LAFIELDS(16,3) = '8'
LAFIELDS(16,4) = '0'
LAFIELDS(17,1) = 'FIELDA16'
LAFIELDS(17,2) = 'C'
LAFIELDS(17,3) = '8'
LAFIELDS(17,4) = '0'

* starting

LAFIELDS(18,1) = 'FIELDB1'
LAFIELDS(18,2) = 'C'
LAFIELDS(18,3) = '6'
LAFIELDS(18,4) = '0'
LAFIELDS(19,1) = 'FIELDB2'
LAFIELDS(19,2) = 'C'
LAFIELDS(19,3) = '6'
LAFIELDS(19,4) = '0'
LAFIELDS(20,1) = 'FIELDB3'
LAFIELDS(20,2) = 'C'
LAFIELDS(20,3) = '6'
LAFIELDS(20,4) = '0'
LAFIELDS(21,1) = 'FIELDB4'
LAFIELDS(21,2) = 'C'
LAFIELDS(21,3) = '6'
LAFIELDS(21,4) = '0'
LAFIELDS(22,1) = 'FIELDB5'
LAFIELDS(22,2) = 'C'
LAFIELDS(22,3) = '6'
LAFIELDS(22,4) = '0'
LAFIELDS(23,1) = 'FIELDB6'
LAFIELDS(23,2) = 'C'
LAFIELDS(23,3) = '6'
LAFIELDS(23,4) = '0'
LAFIELDS(24,1) = 'FIELDB7'
LAFIELDS(24,2) = 'C'
LAFIELDS(24,3) = '6'
LAFIELDS(24,4) = '0'
LAFIELDS(25,1) = 'FIELDB8'
LAFIELDS(25,2) = 'C'
LAFIELDS(25,3) = '6'
LAFIELDS(25,4) = '0'
LAFIELDS(26,1) = 'FIELDB9'
LAFIELDS(26,2) = 'C'
LAFIELDS(26,3) = '6'
LAFIELDS(26,4) = '0'
LAFIELDS(27,1) = 'FIELDB10'
LAFIELDS(27,2) = 'C'
LAFIELDS(27,3) = '6'
LAFIELDS(27,4) = '0'
LAFIELDS(28,1) = 'FIELDB11'
LAFIELDS(28,2) = 'C'
LAFIELDS(28,3) = '6'
LAFIELDS(28,4) = '0'
LAFIELDS(29,1) = 'FIELDB12'
LAFIELDS(29,2) = 'C'
LAFIELDS(29,3) = '6'
LAFIELDS(29,4) = '0'
LAFIELDS(30,1) = 'FIELDB13'
LAFIELDS(30,2) = 'C'
LAFIELDS(30,3) = '6'
LAFIELDS(30,4) = '0'
LAFIELDS(31,1) = 'FIELDB14'
LAFIELDS(31,2) = 'C'
LAFIELDS(31,3) = '6'
LAFIELDS(31,4) = '0'
LAFIELDS(32,1) = 'FIELDB15'
LAFIELDS(32,2) = 'C'
LAFIELDS(32,3) = '6'
LAFIELDS(32,4) = '0'
LAFIELDS(33,1) = 'FIELDB16'
LAFIELDS(33,2) = 'C'
LAFIELDS(33,3) = '6'
LAFIELDS(33,4) = '0' 

LAFIELDS(34,1) = 'FIELDC1'
LAFIELDS(34,2) = 'C'
LAFIELDS(34,3) = '20'
LAFIELDS(34,4) = '0'
LAFIELDS(35,1) = 'FIELDC2'
LAFIELDS(35,2) = 'C'
LAFIELDS(35,3) = '20'
LAFIELDS(35,4) = '0'
LAFIELDS(36,1) = 'FIELDC3'
LAFIELDS(36,2) = 'C'
LAFIELDS(36,3) = '20'
LAFIELDS(36,4) = '0'
LAFIELDS(37,1) = 'FIELDC4'
LAFIELDS(37,2) = 'C'
LAFIELDS(37,3) = '20'
LAFIELDS(37,4) = '0'
LAFIELDS(38,1) = 'FIELDC5'
LAFIELDS(38,2) = 'C'
LAFIELDS(38,3) = '20'
LAFIELDS(38,4) = '0'
LAFIELDS(39,1) = 'FIELDC6'
LAFIELDS(39,2) = 'C'
LAFIELDS(39,3) = '20'
LAFIELDS(39,4) = '0'
LAFIELDS(40,1) = 'FIELDC7'
LAFIELDS(40,2) = 'C'
LAFIELDS(40,3) = '20'
LAFIELDS(40,4) = '0'
LAFIELDS(41,1) = 'FIELDC8'
LAFIELDS(41,2) = 'C'
LAFIELDS(41,3) = '20'
LAFIELDS(41,4) = '0'
LAFIELDS(42,1) = 'FIELDC9'
LAFIELDS(42,2) = 'C'
LAFIELDS(42,3) = '20'
LAFIELDS(42,4) = '0'
LAFIELDS(43,1) = 'FIELDC10'
LAFIELDS(43,2) = 'C'
LAFIELDS(43,3) = '20'
LAFIELDS(43,4) = '0'
LAFIELDS(44,1) = 'FIELDC11'
LAFIELDS(44,2) = 'C'
LAFIELDS(44,3) = '20'
LAFIELDS(44,4) = '0'
LAFIELDS(45,1) = 'FIELDC12'
LAFIELDS(45,2) = 'C'
LAFIELDS(45,3) = '20'
LAFIELDS(45,4) = '0'
LAFIELDS(46,1) = 'FIELDC13'
LAFIELDS(46,2) = 'C'
LAFIELDS(46,3) = '20'
LAFIELDS(46,4) = '0'
LAFIELDS(47,1) = 'FIELDC14'
LAFIELDS(47,2) = 'C'
LAFIELDS(47,3) = '20'
LAFIELDS(47,4) = '0'
LAFIELDS(48,1) = 'FIELDC15'
LAFIELDS(48,2) = 'C'
LAFIELDS(48,3) = '20'
LAFIELDS(48,4) = '0'
LAFIELDS(49,1) = 'FIELDC16'
LAFIELDS(49,2) = 'C'
LAFIELDS(49,3) = '20'
LAFIELDS(49,4) = '0' 


LAFIELDS(50,1) = 'FIELDD1'
LAFIELDS(50,2) = 'C'
LAFIELDS(50,3) = '6'
LAFIELDS(50,4) = '0'
LAFIELDS(51,1) = 'FIELDD2'
LAFIELDS(51,2) = 'C'
LAFIELDS(51,3) = '6'
LAFIELDS(51,4) = '0'
LAFIELDS(52,1) = 'FIELDD3'
LAFIELDS(52,2) = 'C'
LAFIELDS(52,3) = '6'
LAFIELDS(52,4) = '0'
LAFIELDS(53,1) = 'FIELDD4'
LAFIELDS(53,2) = 'C'
LAFIELDS(53,3) = '6'
LAFIELDS(53,4) = '0'
LAFIELDS(54,1) = 'FIELDD5'
LAFIELDS(54,2) = 'C'
LAFIELDS(54,3) = '6'
LAFIELDS(54,4) = '0'
LAFIELDS(55,1) = 'FIELDD6'
LAFIELDS(55,2) = 'C'
LAFIELDS(55,3) = '6'
LAFIELDS(55,4) = '0'
LAFIELDS(56,1) = 'FIELDD7'
LAFIELDS(56,2) = 'C'
LAFIELDS(56,3) = '6'
LAFIELDS(56,4) = '0'
LAFIELDS(57,1) = 'FIELDD8'
LAFIELDS(57,2) = 'C'
LAFIELDS(57,3) = '6'
LAFIELDS(57,4) = '0'
LAFIELDS(58,1) = 'FIELDD9'
LAFIELDS(58,2) = 'C'
LAFIELDS(58,3) = '6'
LAFIELDS(58,4) = '0'
LAFIELDS(59,1) = 'FIELDD10'
LAFIELDS(59,2) = 'C'
LAFIELDS(59,3) = '6'
LAFIELDS(59,4) = '0'
LAFIELDS(60,1) = 'FIELDD11'
LAFIELDS(60,2) = 'C'
LAFIELDS(60,3) = '6'
LAFIELDS(60,4) = '0'
LAFIELDS(61,1) = 'FIELDD12'
LAFIELDS(61,2) = 'C'
LAFIELDS(61,3) = '6'
LAFIELDS(61,4) = '0'
LAFIELDS(62,1) = 'FIELDD13'
LAFIELDS(62,2) = 'C'
LAFIELDS(62,3) = '6'
LAFIELDS(62,4) = '0'
LAFIELDS(63,1) = 'FIELDD14'
LAFIELDS(63,2) = 'C'
LAFIELDS(63,3) = '6'
LAFIELDS(63,4) = '0'
LAFIELDS(64,1) = 'FIELDD15'
LAFIELDS(64,2) = 'C'
LAFIELDS(64,3) = '6'
LAFIELDS(64,4) = '0'
LAFIELDS(65,1) = 'FIELDD16'
LAFIELDS(65,2) = 'C'
LAFIELDS(65,3) = '6'
LAFIELDS(65,4) = '0' 


LAFIELDS(66,1) = 'FIELDE1'
LAFIELDS(66,2) = 'C'
LAFIELDS(66,3) = '30'
LAFIELDS(66,4) = '0'
LAFIELDS(67,1) = 'FIELDE2'
LAFIELDS(67,2) = 'C'
LAFIELDS(67,3) = '30'
LAFIELDS(67,4) = '0'
LAFIELDS(68,1) = 'FIELDE3'
LAFIELDS(68,2) = 'C'
LAFIELDS(68,3) = '30'
LAFIELDS(68,4) = '0'
LAFIELDS(69,1) = 'FIELDE4'
LAFIELDS(69,2) = 'C'
LAFIELDS(69,3) = '30'
LAFIELDS(69,4) = '0'
LAFIELDS(70,1) = 'FIELDE5'
LAFIELDS(70,2) = 'C'
LAFIELDS(70,3) = '30'
LAFIELDS(70,4) = '0'
LAFIELDS(71,1) = 'FIELDE6'
LAFIELDS(71,2) = 'C'
LAFIELDS(71,3) = '30'
LAFIELDS(71,4) = '0'
LAFIELDS(72,1) = 'FIELDE7'
LAFIELDS(72,2) = 'C'
LAFIELDS(72,3) = '30'
LAFIELDS(72,4) = '0'
LAFIELDS(73,1) = 'FIELDE8'
LAFIELDS(73,2) = 'C'
LAFIELDS(73,3) = '30'
LAFIELDS(73,4) = '0'
LAFIELDS(74,1) = 'FIELDE9'
LAFIELDS(74,2) = 'C'
LAFIELDS(74,3) = '30'
LAFIELDS(74,4) = '0'
LAFIELDS(75,1) = 'FIELDE10'
LAFIELDS(75,2) = 'C'
LAFIELDS(75,3) = '30'
LAFIELDS(75,4) = '0'
LAFIELDS(76,1) = 'FIELDE11'
LAFIELDS(76,2) = 'C'
LAFIELDS(76,3) = '30'
LAFIELDS(76,4) = '0'
LAFIELDS(77,1) = 'FIELDE12'
LAFIELDS(77,2) = 'C'
LAFIELDS(77,3) = '30'
LAFIELDS(77,4) = '0'
LAFIELDS(78,1) = 'FIELDE13'
LAFIELDS(78,2) = 'C'
LAFIELDS(78,3) = '30'
LAFIELDS(78,4) = '0'
LAFIELDS(79,1) = 'FIELDE14'
LAFIELDS(79,2) = 'C'
LAFIELDS(79,3) = '30'
LAFIELDS(79,4) = '0'
LAFIELDS(80,1) = 'FIELDE15'
LAFIELDS(80,2) = 'C'
LAFIELDS(80,3) = '30'
LAFIELDS(80,4) = '0'
LAFIELDS(81,1) = 'FIELDE16'
LAFIELDS(81,2) = 'C'
LAFIELDS(81,3) = '30'
LAFIELDS(81,4) = '0' 

LAFIELDS(82,1) = 'FIELDF1'
LAFIELDS(82,2) = 'N'
LAFIELDS(82,3) = '7'
LAFIELDS(82,4) = '3'
LAFIELDS(83,1) = 'FIELDF2'
LAFIELDS(83,2) = 'N'
LAFIELDS(83,3) = '7'
LAFIELDS(83,4) = '3'
LAFIELDS(84,1) = 'FIELDF3'
LAFIELDS(84,2) = 'N'
LAFIELDS(84,3) = '7'
LAFIELDS(84,4) = '3'
LAFIELDS(85,1) = 'FIELDF4'
LAFIELDS(85,2) = 'N'
LAFIELDS(85,3) = '7'
LAFIELDS(85,4) = '3'
LAFIELDS(86,1) = 'FIELDF5'
LAFIELDS(86,2) = 'N'
LAFIELDS(86,3) = '7'
LAFIELDS(86,4) = '3'
LAFIELDS(87,1) = 'FIELDF6'
LAFIELDS(87,2) = 'N'
LAFIELDS(87,3) = '7'
LAFIELDS(87,4) = '3'
LAFIELDS(88,1) = 'FIELDF7'
LAFIELDS(88,2) = 'N'
LAFIELDS(88,3) = '7'
LAFIELDS(88,4) = '3'
LAFIELDS(89,1) = 'FIELDF8'
LAFIELDS(89,2) = 'N'
LAFIELDS(89,3) = '7'
LAFIELDS(89,4) = '3'
LAFIELDS(90,1) = 'FIELDF9'
LAFIELDS(90,2) = 'N'
LAFIELDS(90,3) = '7'
LAFIELDS(90,4) = '3'
LAFIELDS(91,1) = 'FIELDF10'
LAFIELDS(91,2) = 'N'
LAFIELDS(91,3) = '7'
LAFIELDS(91,4) = '3'
LAFIELDS(92,1) = 'FIELDF11'
LAFIELDS(92,2) = 'N'
LAFIELDS(92,3) = '7'
LAFIELDS(92,4) = '3'
LAFIELDS(93,1) = 'FIELDF12'
LAFIELDS(93,2) = 'N'
LAFIELDS(93,3) = '7'
LAFIELDS(93,4) = '3'
LAFIELDS(94,1) = 'FIELDF13'
LAFIELDS(94,2) = 'N'
LAFIELDS(94,3) = '7'
LAFIELDS(94,4) = '3'
LAFIELDS(95,1) = 'FIELDF14'
LAFIELDS(95,2) = 'N'
LAFIELDS(95,3) = '7'
LAFIELDS(95,4) = '3'
LAFIELDS(96,1) = 'FIELDF15'
LAFIELDS(96,2) = 'N'
LAFIELDS(96,3) = '7'
LAFIELDS(96,4) = 'C'
LAFIELDS(97,1) = 'FIELDF16'
LAFIELDS(97,2) = 'N'
LAFIELDS(97,3) = '7'
LAFIELDS(97,4) = '3' 

LAFIELDS(98,1) = 'FIELDG1'
LAFIELDS(98,2) = 'C'
LAFIELDS(98,3) = '30'
LAFIELDS(98,4) = '0'
LAFIELDS(99,1) = 'FIELDG2'
LAFIELDS(99,2) = 'C'
LAFIELDS(99,3) = '30'
LAFIELDS(99,4) = '0'
LAFIELDS(100,1) = 'FIELDG3'
LAFIELDS(100,2) = 'C'
LAFIELDS(100,3) = '30'
LAFIELDS(100,4) = '0'
LAFIELDS(101,1) = 'FIELDG4'
LAFIELDS(101,2) = 'C'
LAFIELDS(101,3) = '30'
LAFIELDS(101,4) = '0'
LAFIELDS(102,1) = 'FIELDG5'
LAFIELDS(102,2) = 'C'
LAFIELDS(102,3) = '30'
LAFIELDS(102,4) = '0'
LAFIELDS(103,1) = 'FIELDG6'
LAFIELDS(103,2) = 'C'
LAFIELDS(103,3) = '30'
LAFIELDS(103,4) = '0'
LAFIELDS(104,1) = 'FIELDG7'
LAFIELDS(104,2) = 'C'
LAFIELDS(104,3) = '30'
LAFIELDS(104,4) = '0'
LAFIELDS(105,1) = 'FIELDG8'
LAFIELDS(105,2) = 'C'
LAFIELDS(105,3) = '30'
LAFIELDS(105,4) = '0'
LAFIELDS(106,1) = 'FIELDG9'
LAFIELDS(106,2) = 'C'
LAFIELDS(106,3) = '30'
LAFIELDS(106,4) = '0'
LAFIELDS(107,1) = 'FIELDG10'
LAFIELDS(107,2) = 'C'
LAFIELDS(107,3) = '30'
LAFIELDS(107,4) = '0'
LAFIELDS(108,1) = 'FIELDG11'
LAFIELDS(108,2) = 'C'
LAFIELDS(108,3) = '30'
LAFIELDS(108,4) = '0'
LAFIELDS(109,1) = 'FIELDG12'
LAFIELDS(109,2) = 'C'
LAFIELDS(109,3) = '30'
LAFIELDS(109,4) = '0'
LAFIELDS(110,1) = 'FIELDG13'
LAFIELDS(110,2) = 'C'
LAFIELDS(110,3) = '30'
LAFIELDS(110,4) = '0'
LAFIELDS(111,1) = 'FIELDG14'
LAFIELDS(111,2) = 'C'
LAFIELDS(111,3) = '30'
LAFIELDS(111,4) = '0'
LAFIELDS(112,1) = 'FIELDG15'
LAFIELDS(112,2) = 'C'
LAFIELDS(112,3) = '30'
LAFIELDS(112,4) = '0'
LAFIELDS(113,1) = 'FIELDG16'
LAFIELDS(113,2) = 'C'
LAFIELDS(113,3) = '30'
LAFIELDS(113,4) = '0' 


LAFIELDS(114,1) = 'FIELDH1'
LAFIELDS(114,2) = 'C'
LAFIELDS(114,3) = '30'
LAFIELDS(114,4) = '0'
LAFIELDS(115,1) = 'FIELDH2'
LAFIELDS(115,2) = 'C'
LAFIELDS(115,3) = '30'
LAFIELDS(115,4) = '0'
LAFIELDS(116,1) = 'FIELDH3'
LAFIELDS(116,2) = 'C'
LAFIELDS(116,3) = '30'
LAFIELDS(116,4) = '0'
LAFIELDS(117,1) = 'FIELDH4'
LAFIELDS(117,2) = 'C'
LAFIELDS(117,3) = '30'
LAFIELDS(117,4) = '0'
LAFIELDS(118,1) = 'FIELDH5'
LAFIELDS(118,2) = 'C'
LAFIELDS(118,3) = '30'
LAFIELDS(118,4) = '0'
LAFIELDS(119,1) = 'FIELDH6'
LAFIELDS(119,2) = 'C'
LAFIELDS(119,3) = '30'
LAFIELDS(119,4) = '0'
LAFIELDS(120,1) = 'FIELDH7'
LAFIELDS(120,2) = 'C'
LAFIELDS(120,3) = '30'
LAFIELDS(120,4) = '0'
LAFIELDS(121,1) = 'FIELDH8'
LAFIELDS(121,2) = 'C'
LAFIELDS(121,3) = '30'
LAFIELDS(121,4) = '0'
LAFIELDS(122,1) = 'FIELDH9'
LAFIELDS(122,2) = 'C'
LAFIELDS(122,3) = '30'
LAFIELDS(122,4) = '0'
LAFIELDS(123,1) = 'FIELDH10'
LAFIELDS(123,2) = 'C'
LAFIELDS(123,3) = '30'
LAFIELDS(123,4) = '0'
LAFIELDS(124,1) = 'FIELDH11'
LAFIELDS(124,2) = 'C'
LAFIELDS(124,3) = '30'
LAFIELDS(124,4) = '0'
LAFIELDS(125,1) = 'FIELDH12'
LAFIELDS(125,2) = 'C'
LAFIELDS(125,3) = '30'
LAFIELDS(125,4) = '0'
LAFIELDS(126,1) = 'FIELDH13'
LAFIELDS(126,2) = 'C'
LAFIELDS(126,3) = '30'
LAFIELDS(126,4) = '0'
LAFIELDS(127,1) = 'FIELDH14'
LAFIELDS(127,2) = 'C'
LAFIELDS(127,3) = '30'
LAFIELDS(127,4) = '0'
LAFIELDS(128,1) = 'FIELDH15'
LAFIELDS(128,2) = 'C'
LAFIELDS(128,3) = '30'
LAFIELDS(128,4) = '0'
LAFIELDS(129,1) = 'FIELDH16'
LAFIELDS(129,2) = 'C'
LAFIELDS(129,3) = '30'
LAFIELDS(129,4) = '0' 

LAFIELDS(130,1) = 'FIELDI1'
LAFIELDS(130,2) = 'N'
LAFIELDS(130,3) = '12'
LAFIELDS(130,4) = '3'
LAFIELDS(131,1) = 'FIELDI2'
LAFIELDS(131,2) = 'N'
LAFIELDS(131,3) = '12'
LAFIELDS(131,4) = '3'
LAFIELDS(132,1) = 'FIELDI3'
LAFIELDS(132,2) = 'N'
LAFIELDS(132,3) = '12'
LAFIELDS(132,4) = '3'
LAFIELDS(133,1) = 'FIELDI4'
LAFIELDS(133,2) = 'N'
LAFIELDS(133,3) = '12'
LAFIELDS(133,4) = '3'
LAFIELDS(134,1) = 'FIELDI5'
LAFIELDS(134,2) = 'N'
LAFIELDS(134,3) = '12'
LAFIELDS(134,4) = '3'
LAFIELDS(135,1) = 'FIELDI6'
LAFIELDS(135,2) = 'N'
LAFIELDS(135,3) = '12'
LAFIELDS(135,4) = '3'
LAFIELDS(136,1) = 'FIELDI7'
LAFIELDS(136,2) = 'N'
LAFIELDS(136,3) = '12'
LAFIELDS(136,4) = '3'
LAFIELDS(137,1) = 'FIELDI8'
LAFIELDS(137,2) = 'N'
LAFIELDS(137,3) = '12'
LAFIELDS(137,4) = '3'
LAFIELDS(138,1) = 'FIELDI9'
LAFIELDS(138,2) = 'N'
LAFIELDS(138,3) = '12'
LAFIELDS(138,4) = '3'
LAFIELDS(139,1) = 'FIELDI10'
LAFIELDS(139,2) = 'N'
LAFIELDS(139,3) = '12'
LAFIELDS(139,4) = '3'
LAFIELDS(140,1) = 'FIELDI11'
LAFIELDS(140,2) = 'N'
LAFIELDS(140,3) = '12'
LAFIELDS(140,4) = '3'
LAFIELDS(141,1) = 'FIELDI12'
LAFIELDS(141,2) = 'N'
LAFIELDS(141,3) = '12'
LAFIELDS(141,4) = '3'
LAFIELDS(142,1) = 'FIELDI13'
LAFIELDS(142,2) = 'N'
LAFIELDS(142,3) = '12'
LAFIELDS(142,4) = '3'
LAFIELDS(143,1) = 'FIELDI14'
LAFIELDS(143,2) = 'N'
LAFIELDS(143,3) = '12'
LAFIELDS(143,4) = '3'
LAFIELDS(144,1) = 'FIELDI15'
LAFIELDS(144,2) = 'N'
LAFIELDS(144,3) = '12'
LAFIELDS(144,4) = '3'
LAFIELDS(145,1) = 'FIELDI16'
LAFIELDS(145,2) = 'N'
LAFIELDS(145,3) = '12'
LAFIELDS(145,4) = '3' 

LAFIELDS(146,1) = 'FIELDJ1'
LAFIELDS(146,2) = 'N'
LAFIELDS(146,3) = '12'
LAFIELDS(146,4) = '3'
LAFIELDS(147,1) = 'FIELDJ2'
LAFIELDS(147,2) = 'N'
LAFIELDS(147,3) = '12'
LAFIELDS(147,4) = '3'
LAFIELDS(148,1) = 'FIELDJ3'
LAFIELDS(148,2) = 'N'
LAFIELDS(148,3) = '12'
LAFIELDS(148,4) = '3'
LAFIELDS(149,1) = 'FIELDJ4'
LAFIELDS(149,2) = 'N'
LAFIELDS(149,3) = '12'
LAFIELDS(149,4) = '3'
LAFIELDS(150,1) = 'FIELDJ5'
LAFIELDS(150,2) = 'N'
LAFIELDS(150,3) = '12'
LAFIELDS(150,4) = '3'
LAFIELDS(151,1) = 'FIELDJ6'
LAFIELDS(151,2) = 'N'
LAFIELDS(151,3) = '12'
LAFIELDS(151,4) = '3'
LAFIELDS(152,1) = 'FIELDJ7'
LAFIELDS(152,2) = 'N'
LAFIELDS(152,3) = '12'
LAFIELDS(152,4) = '3'
LAFIELDS(153,1) = 'FIELDJ8'
LAFIELDS(153,2) = 'N'
LAFIELDS(153,3) = '12'
LAFIELDS(153,4) = '3'
LAFIELDS(154,1) = 'FIELDJ9'
LAFIELDS(154,2) = 'N'
LAFIELDS(154,3) = '12'
LAFIELDS(154,4) = '3'
LAFIELDS(155,1) = 'FIELDJ10'
LAFIELDS(155,2) = 'N'
LAFIELDS(155,3) = '12'
LAFIELDS(155,4) = '3'
LAFIELDS(156,1) = 'FIELDJ11'
LAFIELDS(156,2) = 'N'
LAFIELDS(156,3) = '12'
LAFIELDS(156,4) = '3'
LAFIELDS(157,1) = 'FIELDJ12'
LAFIELDS(157,2) = 'N'
LAFIELDS(157,3) = '12'
LAFIELDS(157,4) = '3'
LAFIELDS(158,1) = 'FIELDJ13'
LAFIELDS(158,2) = 'N'
LAFIELDS(158,3) = '12'
LAFIELDS(158,4) = '3'
LAFIELDS(159,1) = 'FIELDJ14'
LAFIELDS(159,2) = 'N'
LAFIELDS(159,3) = '12'
LAFIELDS(159,4) = '3'
LAFIELDS(160,1) = 'FIELDJ15'
LAFIELDS(160,2) = 'N'
LAFIELDS(160,3) = '12'
LAFIELDS(160,4) = '3'
LAFIELDS(161,1) = 'FIELDJ16'
LAFIELDS(161,2) = 'N'
LAFIELDS(161,3) = '12'
LAFIELDS(161,4) = '3' 

LAFIELDS(162,1) = 'FIELDK1'
LAFIELDS(162,2) = 'C'
LAFIELDS(162,3) = '30'
LAFIELDS(162,4) = '0'
LAFIELDS(163,1) = 'FIELDK2'
LAFIELDS(163,2) = 'C'
LAFIELDS(163,3) = '30'
LAFIELDS(163,4) = '0'
LAFIELDS(164,1) = 'FIELDK3'
LAFIELDS(164,2) = 'C'
LAFIELDS(164,3) = '30'
LAFIELDS(164,4) = '0'
LAFIELDS(165,1) = 'FIELDK4'
LAFIELDS(165,2) = 'C'
LAFIELDS(165,3) = '30'
LAFIELDS(165,4) = '0'
LAFIELDS(166,1) = 'FIELDK5'
LAFIELDS(166,2) = 'C'
LAFIELDS(166,3) = '30'
LAFIELDS(166,4) = '0'
LAFIELDS(167,1) = 'FIELDK6'
LAFIELDS(167,2) = 'C'
LAFIELDS(167,3) = '30'
LAFIELDS(167,4) = '0'
LAFIELDS(168,1) = 'FIELDK7'
LAFIELDS(168,2) = 'C'
LAFIELDS(168,3) = '30'
LAFIELDS(168,4) = '0'
LAFIELDS(169,1) = 'FIELDK8'
LAFIELDS(169,2) = 'C'
LAFIELDS(169,3) = '30'
LAFIELDS(169,4) = '0'
LAFIELDS(170,1) = 'FIELDK9'
LAFIELDS(170,2) = 'C'
LAFIELDS(170,3) = '30'
LAFIELDS(170,4) = '0'
LAFIELDS(171,1) = 'FIELDK10'
LAFIELDS(171,2) = 'C'
LAFIELDS(171,3) = '30'
LAFIELDS(171,4) = '0'
LAFIELDS(172,1) = 'FIELDK11'
LAFIELDS(172,2) = 'C'
LAFIELDS(172,3) = '30'
LAFIELDS(172,4) = '0'
LAFIELDS(173,1) = 'FIELDK12'
LAFIELDS(173,2) = 'C'
LAFIELDS(173,3) = '30'
LAFIELDS(173,4) = '0'
LAFIELDS(174,1) = 'FIELDK13'
LAFIELDS(174,2) = 'C'
LAFIELDS(174,3) = '30'
LAFIELDS(174,4) = '0'
LAFIELDS(175,1) = 'FIELDK14'
LAFIELDS(175,2) = 'C'
LAFIELDS(175,3) = '30'
LAFIELDS(175,4) = '0'
LAFIELDS(176,1) = 'FIELDK15'
LAFIELDS(176,2) = 'C'
LAFIELDS(176,3) = '30'
LAFIELDS(176,4) = '0'
LAFIELDS(177,1) = 'FIELDK16'
LAFIELDS(177,2) = 'C'
LAFIELDS(177,3) = '30'
LAFIELDS(177,4) = '0'

CREATE CURSOR SFH FROM ARRAY LAFIELDS
INDEX ON PO TAG PO ADDITIVE

SELE POSLN
SET RELATION TO PO INTO SFH ADDITIVE

SELE TEMP
SET ORDER TO DATI
SET RELATION TO SUBSTR(ITEM,1,7)+ICLR INTO FABRIC ADDITIVE
SELE FABRIC
SET RELATION TO 'N'+FABRIC.ITEM_TYPE+'N'+'ITEM_TYPE' INTO CODES ADDITIVE
STORE ' ' TO LCPO


SET RELATION TO TEMP.CWARECODE INTO WAREHOUS 
SELE WAREHOUS


SET RELATION TO TEMP.CPVENDOR INTO APVENDOR ADDITIVE
SELECT APVENDOR


SELE TEMP

GO TOP

******************************
***  Added this next line.
DO WHILE .T.

IF !EOF()
	SELE SFH
    IF !SEEK(TEMP.CUTTKT)
		APPEND BLANK
		REPLACE PO WITH TEMP.CUTTKT
	ENDIF	
	SELE TEMP
	STORE CUTTKT TO LCPO
	FOR I = 1 TO 16
		J = ALLTRIM(STR(I,2))
		SELECT SFH
		REPLACE FIELDA&J WITH TEMP.ITEM
		REPLACE FIELDB&J WITH FABRIC.WIDTH
		REPLACE FIELDC&J WITH FABRIC.DESC
		REPLACE FIELDD&J WITH TEMP.ICLR
	    REPLACE FIELDE&J WITH SUBSTR(WAREHOUS.CDESC,1,15)
		REPLACE FIELDF&J WITH TEMP.UNTQTY
   		REPLACE FIELDG&J WITH APVENDOR.CVENCOMP
        REPLACE FIELDK&J WITH FABRIC.CONTENT 
		REPLACE FIELDI&J WITH TEMP.REQ_QTY
        REPLACE FIELDJ&J WITH TEMP.ISSUE_QTY
        REPLACE FIELDH&J WITH TEMP.CPMATPO
		SELECT TEMP

		IF !EOF()
		   SKIP
			IF CUTTKT <> LCPO
				EXIT
			ENDIF	
		ENDIF
	ENDFOR
ENDIF
*******************************
***  Added these next 4 lines
IF EOF()
	EXIT
ENDIF	
ENDDO

SELE FABRIC
SET RELATION TO

DIME LAFIELD(10,4)
LAFIELD(1,1) = 'PO'
LAFIELD(1,2) = 'C'
LAFIELD(1,3) = '6'
LAFIELD(1,4) = '0'
LAFIELD(2,1) = 'STYLE'
LAFIELD(2,2) = 'C'
LAFIELD(2,3) = '19'
LAFIELD(2,4) = '0'
LAFIELD(3,1) = 'QTY9'
LAFIELD(3,2) = 'N'
LAFIELD(3,3) = '6'
LAFIELD(3,4) = '0'
LAFIELD(4,1) = 'QTY10'
LAFIELD(4,2) = 'N'
LAFIELD(4,3) = '6'
LAFIELD(4,4) = '0'
LAFIELD(5,1) = 'TOTQTY'
LAFIELD(5,2) = 'N'
LAFIELD(5,3) = '6'
LAFIELD(5,4) = '0'
LAFIELD(6,1) = 'SCALE9'
LAFIELD(6,2) = 'C'
LAFIELD(6,3) = '5'
LAFIELD(6,4) = '0'
LAFIELD(7,1) = 'SCALE10'
LAFIELD(7,2) = 'C'
LAFIELD(7,3) = '5'
LAFIELD(7,4) = '0'
LAFIELD(8,1) = 'LineNo'
LAFIELD(8,2) = 'N'
LAFIELD(8,3) = '6'
LAFIELD(8,4) = '0'
LAFIELD(9,1) = 'rat9'
LAFIELD(9,2) = 'N'
LAFIELD(9,3) = '6'
LAFIELD(9,4) = '0'
LAFIELD(10,1) = 'rat10'
LAFIELD(10,2) = 'N'
LAFIELD(10,3) = '6'
LAFIELD(10,4) = '0'
CREATE CURSOR XTRAQTYS FROM ARRAY LAFIELD
SELE XTRAQTYS
INDEX ON PO+STYLE+STR(LINENO,6) TAG XTRAQTYS ADDITIVE

DIME laPosLn(30,4)
laPosLn(1,1) = 'CStyType'
laPosLn(1,2) = 'C'
laPosLn(1,3) = '1'
laPosLn(1,4) = '0'
laPosLn(2,1) = 'PO'
laPosLn(2,2) = 'C'
laPosLn(2,3) = '6'
laPosLn(2,4) = '0'
laPosLn(3,1) = 'Style'
laPosLn(3,2) = 'C'
laPosLn(3,3) = '19'
laPosLn(3,4) = '0'
laPosLn(4,1) = 'Scale'
laPosLn(4,2) = 'C'
laPosLn(4,3) = '3'
laPosLn(4,4) = '0'
laPosLn(5,1) = 'LineNo'
laPosLn(5,2) = 'N'
laPosLn(5,3) = '6'
laPosLn(5,4) = '0'
laPosLn(6,1) = 'TranCd'
laPosLn(6,2) = 'C'
laPosLn(6,3) = '1'
laPosLn(6,4) = '0'
laPosLn(7,1) = 'Qty1'
laPosLn(7,2) = 'N'
laPosLn(7,3) = '6'
laPosLn(7,4) = '0'
laPosLn(8,1) = 'Qty2'
laPosLn(8,2) = 'N'
laPosLn(8,3) = '6'
laPosLn(8,4) = '0'
laPosLn(9,1) = 'Qty3'
laPosLn(9,2) = 'N'
laPosLn(9,3) = '6'
laPosLn(9,4) = '0'
laPosLn(10,1) = 'Qty4'
laPosLn(10,2) = 'N'
laPosLn(10,3) = '6'
laPosLn(10,4) = '0'
laPosLn(11,1) = 'Qty5'
laPosLn(11,2) = 'N'
laPosLn(11,3) = '6'
laPosLn(11,4) = '0'
laPosLn(12,1) = 'Qty6'
laPosLn(12,2) = 'N'
laPosLn(12,3) = '6'
laPosLn(12,4) = '0'
laPosLn(13,1) = 'Qty7'
laPosLn(13,2) = 'N'
laPosLn(13,3) = '6'
laPosLn(13,4) = '0'
laPosLn(14,1) = 'Qty8'
laPosLn(14,2) = 'N'
laPosLn(14,3) = '6'
laPosLn(14,4) = '0'
laPosLn(15,1) = 'TotQty'
laPosLn(15,2) = 'N'
laPosLn(15,3) = '7'
laPosLn(15,4) = '0'
laPosLn(16,1) = 'Rat1'
laPosLn(16,2) = 'N'
laPosLn(16,3) = '7'
laPosLn(16,4) = '0'
laPosLn(17,1) = 'Rat2'
laPosLn(17,2) = 'N'
laPosLn(17,3) = '7'
laPosLn(17,4) = '0'
laPosLn(18,1) = 'Rat3'
laPosLn(18,2) = 'N'
laPosLn(18,3) = '7'
laPosLn(18,4) = '0'
laPosLn(19,1) = 'Rat4'
laPosLn(19,2) = 'N'
laPosLn(19,3) = '7'
laPosLn(19,4) = '0'
laPosLn(20,1) = 'Rat5'
laPosLn(20,2) = 'N'
laPosLn(20,3) = '7'
laPosLn(20,4) = '0'
laPosLn(21,1) = 'Rat6'
laPosLn(21,2) = 'N'
laPosLn(21,3) = '7'
laPosLn(21,4) = '0'
laPosLn(22,1) = 'Rat7'
laPosLn(22,2) = 'N'
laPosLn(22,3) = '7'
laPosLn(22,4) = '0'
laPosLn(23,1) = 'Rat8'
laPosLn(23,2) = 'N'
laPosLn(23,3) = '7'
laPosLn(23,4) = '0'
laPosLn(24,1) = 'Rat9'
laPosLn(24,2) = 'N'
laPosLn(24,3) = '7'
laPosLn(24,4) = '0'
laPosLn(25,1) = 'Rat10'
laPosLn(25,2) = 'N'
laPosLn(25,3) = '7'
laPosLn(25,4) = '0'
laPosLn(26,1) = 'DPostDate'
laPosLn(26,2) = 'D'
laPosLn(26,3) = '8'
laPosLn(26,4) = '0'
laPosLn(27,1) = 'Vendor'
laPosLn(27,2) = 'C'
laPosLn(27,3) = '8'
laPosLn(27,4) = '0'
laPosLn(28,1) = 'Ncost1'
laPosLn(28,2) = 'N'
laPosLn(28,3) = '16'
laPosLn(28,4) = '3'
laPosLn(29,1) = 'XSTYLE'
laPosLn(29,2) = 'C'
laPosLn(29,3) = '19'
laPosLn(29,4) = ' '
laPosLn(30,1) = 'XTRA'
laPosLn(30,2) = 'C'
laPosLn(30,3) = '1'
laPosLn(30,4) = ' '
CREATE CURSOR MPosln FROM ARRAY laPosLN
SELECT MPosLn
INDEX ON cstytype+po+style+STR(lineno,6)+trancd TAG MPosLn ADDITIVE
INDEX ON style+cstytype+po+STR(lineno,6)+trancd TAG MPosLns ADDITIVE
CREATE CURSOR MPoslnTemp FROM ARRAY laPosLN
SELECT MPosLnTemp
INDEX ON cstytype+po+style+STR(lineno,6)+trancd TAG MPosLnTemp ADDITIVE

*C037144,1 08/24/2003  [Start]
IF llPOsRang
  SELECT (lcPOsFile)
  SCAN
    IF SEEK('P'+PO,'POSLN')
      SELECT POSLN
      SCAN REST WHILE CSTYTYPE+PO = 'P'+EVALUATE(lcPOsFile+'.PO')
        wait window nowait posln.po
        SELE MPosLn
        APPEND BLANK
        REPLACE CStyType WITH PosLn.CStyType, Po WITH PosLn.Po, Style WITH PosLn.Style, Scale WITH PosLn.Scale, ;
                LineNo WITH PosLn.LineNo, TranCd WITH PosLn.TranCd, Qty1 WITH PosLn.Qty1, Qty2 WITH PosLn.Qty2, Qty3 WITH PosLn.Qty3, ;
                Qty4 WITH PosLn.Qty4, Qty5 WITH PosLn.Qty5, Qty6 WITH PosLn.Qty6, Qty7 WITH PosLn.Qty7, Qty8 WITH PosLn.Qty8, ;
                TotQty WITH PosLn.TotQty
        REPLACE Vendor with posln.vendor
        REPLACE Ncost1 WITH Posln.Ncost1 
        REPL XTRA WITH "N"
        SELE STYLE
        IF SEEK(POSLN.STYLE)
          IF LOCATION = "EXTRA"
            SELE MPOSLN
            REPL MPOSLN.XTRA WITH "Y"
          ENDIF
        ENDIF  
        SELE MPOSLN
        REPL XSTYLE WITH SUBSTR(STYLE.CCONSINFO1,1,12)+"-"+SUBSTR(STYLE.CCONSINFO2,1,6)
        SELE CutPick
        IF SEEK('2'+MPosln.Po+MPosLn.Style)
          ldComplete = { }
          SELE Ordline	
          IF SEEK('O'+CutPick.Order+CutPick.COrdLine)
            ldComplete = START-7
            REPLACE MPOSLN.DPOSTDATE WITH LDCOMPLETE
          ENDIF	
        ENDIF
        SELE PosLn
      ENDSCAN
    ENDIF
  ENDSCAN
ELSE
*C037144,1 08/24/2003 AMH [End]

SELE PosLn
SET ORDER TO POSLN

*C037144,1 08/24/2003 AMH [Start]
*SET FILTER TO &lcRpExp
*C037144,1 08/24/2003 AMH [End]

YSTYLE = ' ' 
LNLINENO = 0
wait window lcrpexp 
**SCAN FOR &LCRPEXP
SCAN
      wait window nowait posln.po
      SELE MPosLn
	  APPEND BLANK
	  REPLACE CStyType WITH PosLn.CStyType, Po WITH PosLn.Po, Style WITH PosLn.Style, Scale WITH PosLn.Scale, ;
		LineNo WITH PosLn.LineNo, TranCd WITH PosLn.TranCd, Qty1 WITH PosLn.Qty1, Qty2 WITH PosLn.Qty2, Qty3 WITH PosLn.Qty3, ;
		Qty4 WITH PosLn.Qty4, Qty5 WITH PosLn.Qty5, Qty6 WITH PosLn.Qty6, Qty7 WITH PosLn.Qty7, Qty8 WITH PosLn.Qty8, ;
		TotQty WITH PosLn.TotQty
      REPLACE Vendor with posln.vendor
**      REPLACE DPostDate WITH PosLn.DPostDate
      REPLACE Ncost1 WITH Posln.Ncost1 
**      REPL DPostDate WITH {10/01/2001 }
      REPL XTRA WITH "N"
      SELE STYLE
      IF SEEK(POSLN.STYLE)
       IF LOCATION = "EXTRA"
        SELE MPOSLN
        REPL MPOSLN.XTRA WITH "Y"
       ENDIF
      ENDIF  
      SELE MPOSLN
      REPL XSTYLE WITH SUBSTR(STYLE.CCONSINFO1,1,12)+"-"+SUBSTR(STYLE.CCONSINFO2,1,6)
      SELE CutPick
	  IF SEEK('2'+MPosln.Po+MPosLn.Style)
			ldComplete = { }
			SELE Ordline	
			IF SEEK('O'+CutPick.Order+CutPick.COrdLine)
				ldComplete = START-7
                REPLACE MPOSLN.DPOSTDATE WITH LDCOMPLETE
			ENDIF	
      ENDIF
    SELE PosLn
ENDSCAN

*C037144,1 08/24/2003 AMH [Start]
ENDIF
*C037144,1 08/24/2003 AMH [End]

LCRPEXP = STRTRAN(LCRPEXP,'POSLN','MPOSLN')

SELE MPosLn
SET ORDER TO MPosLn
SET RELATION TO CSTYTYPE+PO INTO POSHDR ADDITIVE
SET RELATION TO STYLE INTO STYLE ADDITIVE
SET RELATION TO '2'+PO+STYLE INTO CUTPICK ADDITIVE
SET RELATION TO 'S'+SCALE INTO SCALE ADDITIVE
SET RELATION TO 'P'+PO INTO NOTEPAD ADDITIVE
SET RELATION TO PO+STYLE+STR(LINENO,6) INTO XTRAQTYS ADDITIVE
SET RELATION TO PO INTO SFH ADDITIVE
GO TOP

STORE 1000 TO lnb

SELE MPosLn
LCRPEXP = LCRPEXP + " AND MPosLn.XTRA <> 'Y' AND MPOSLN.TRANCD = '1'"
GO TOP
SCAN FOR &LCRPEXP
    XPO = PO
	HRECNO = RECNO()
	lnLineNo = LineNo
	SELE MPosln
    YSTYLE = MPOSLN.STYLE
   	SET ORDER TO MPosLns
	IF SEEK(MPOSLN.XSTYLE+'P'+XPO)
        SELE XTRAQTYS
		IF !SEEK(MPosLn.PO+YSTYLE+STR(MPosLn.LineNo,6))
		    APPEND BLANK
			REPLACE PO WITH MPosLn.PO, STYLE WITH YSTYLE, QTY9 WITH MPOSLN.QTY1, QTY10 WITH MPOSLN.QTY2, TOTQTY WITH QTY9+QTY10
			REPLACE LineNo WITH lnLineNo
			SELE SCALE
			IF SEEK('S'+MPOSLN.SCALE)
				SELE XTRAQTYS
				REPL SCALE9 WITH SCALE.SZ1, SCALE10 WITH SCALE.SZ2
			ENDIF	
		ENDIF
        SELE MPosLn
		DELE
	ENDIF
	SELE MPosLn
	SET ORDER TO MPosLn
	GOTO HRECNO
ENDSCAN
SELE XTRAQTYS
GO TOP


SELE ORDHDR
SET RELATION TO 'M'+ACCOUNT INTO CUSTOMER ADDITIVE
SELE FABRIC
SET ORDER TO CFABRIC
SELE STYLE
SET RELATION TO 'S'+CSTYMAJOR INTO OBJLINK ADDITIVE
SET RELATION TO FABRIC INTO FABRIC ADDITIVE
SELE OBJLINK
SET RELATION TO COBJECT_ID INTO OBJECTS ADDITIVE
SELE MPosLn
SET RELATION TO 'N'+PADR(SUBSTR(STYLE,LNSTYLEMAJ+2,LNCOLORLEN),6)+'N'+'COLOR' INTO CODES ADDITIVE
SET RELATION TO VENDOR INTO APVENDOR ADDITIVE
SET ORDER TO MPosLn
DO LPRATIO
SELE MPOSLN
GO TOP


DO GFDISPRE WITH EVAL('LCFORMNAME') , 'FOR ' + LCRPEXP

SELE POFLN
SET RELA TO 

SELE POSLN
SET RELA TO

SELE OBJLINK
SET RELA TO

FUNCTION lfwRepWhen

PROCEDURE LPRATIO
SELECT MPOSLN
GO TOP
SCAN FOR &LCRPEXP
  
 REPLACE RAT1 WITH 0	
 REPLACE RAT2 with 0
 REPLACE RAT3 WITH 0	
 REPLACE RAT4 WITH 0	
 REPLACE RAT5 WITH 0	
 REPLACE RAT6 WITH 0	
 REPLACE RAT7 WITH 0
 REPLACE RAT8 WITH 0	
 REPLACE RAT9 WITH 0
 REPLACE RAT10 WITH 0
 SELE CutPick
 SET ORDER TO CUTPICK 
 XSCALE = MPOSLN.SCALE
 lcpack = "N"
 COUNT = 0
 LCPREPACK = " "
 IF SEEK('2'+MPosln.Po+MPosLn.Style)
 	SELE Ordline	  
    if seek('O'+cutpick.order+cutpick.cordline)
            do while .t.
				if eof()
                 exit
				endif
				if order <> cutpick.order
					exit
				endif
                if PREPAK = " "
                 IF COUNT > 0
                  LCPREPACK = " "
                  EXIT
                 ENDIF 
**                 SKIP
                ENDIF
                IF COUNT = 0
                 COUNT = COUNT+1
                 LCPREPACK = PREPAK
**                 SKIP
                ENDIF
                IF PREPAK <> LCPREPACK
                 LCPREPACK = " "
                  EXIT
                ENDIF
                SKIP
             ENDDO   
    ENDIF            
 ENDIF                
 IF LCPREPACK <> " " 	
   DO LPFILLRATIO
 ENDIF   
ENDSCAN

PROCEDURE LPFILLRATIO
SELE STYLE
IF SEEK(MPOSLN.STYLE)
 SELE SCALE
 IF SEEK('P'+STYLE.SCALE+LCPREPACK)
    SELE MPOSLN
    REPLACE RAT1 WITH SCALE.PP1	
	REPLACE RAT2 WITH SCALE.PP2	
	REPLACE RAT3 WITH SCALE.PP3
	REPLACE RAT4 WITH SCALE.PP4	
	REPLACE RAT5 WITH SCALE.PP5
	REPLACE RAT6 WITH SCALE.PP6
	REPLACE RAT7 WITH SCALE.PP7	
	REPLACE RAT8 WITH SCALE.PP8
 ENDIF	
ENDIF
SELE STYLE
IF SEEK(MPOSLN.XSTYLE)
	SELE SCALE
	IF SEEK('P'+STYLE.SCALE+LCPREPACK)
		SELE MPOSLN
		REPL RAT9 WITH SCALE.PP1
		REPL RAT10 WITH SCALE.PP2
	ENDIF	
ENDIF	
	
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using DevExpress.ExpressApp.DC;
using DevExpress.Persistent.Base;
using DevExpress.Persistent.BaseImpl;
using DevExpress.Xpo;
using System.ComponentModel;
using DevExpress.ExpressApp.Security;
using DevExpress.ExpressApp;
using DevExpress.Data.Filtering;
namespace Aria5SystemAdmin.Module.BusinessObjects
{
  [DefaultClassOptions]
    public partial class EntityOperationPermission : DevExpress.Persistent.BaseImpl.BaseObject
  {
    private Aria5SystemAdmin.Module.BusinessObjects.AriaSecuritySystemRole _ariaSecuritySystemRole;
    private Aria5SystemAdmin.Module.BusinessObjects.Application_T _application_T;
    private Aria5SystemAdmin.Module.BusinessObjects.AriaObject _ariaObject;
    private System.Boolean _allowView;
    private System.Boolean _allowDelete;
    private System.Boolean _allowEdit;
    private System.Boolean _allowAdd;
    public EntityOperationPermission(DevExpress.Xpo.Session session)
      : base(session)
    {
    }
    public System.Boolean AllowAdd
    {
      get
      {
        return _allowAdd;
      }
      set
      {
        SetPropertyValue("AllowAdd", ref _allowAdd, value);
      }
    }
    public System.Boolean AllowEdit
    {
      get
      {
        return _allowEdit;
      }
      set
      {
        SetPropertyValue("AllowEdit", ref _allowEdit, value);
      }
    }
    public System.Boolean AllowDelete
    {
      get
      {
        return _allowDelete;
      }
      set
      {
        SetPropertyValue("AllowDelete", ref _allowDelete, value);
      }
    }
    public System.Boolean AllowView
    {
      get
      {
        return _allowView;
      }
      set
      {
        SetPropertyValue("AllowView", ref _allowView, value);
      }
    }
    [DevExpress.Persistent.Base.DataSourcePropertyAttribute("Application_T.AriaObjects")]
    [DevExpress.ExpressApp.DC.XafDisplayNameAttribute("Entity")]
    public Aria5SystemAdmin.Module.BusinessObjects.AriaObject AriaObject
    {
      get
      {
        return _ariaObject;
      }
      set
      {
        SetPropertyValue("AriaObject", ref _ariaObject, value);
      }
    }
    [DevExpress.ExpressApp.DC.XafDisplayNameAttribute("Application")]
    [DataSourceProperty("AvailableApplications")]
    public Aria5SystemAdmin.Module.BusinessObjects.Application_T Application_T
    {
      get
      {
        return _application_T;
      }
      set
      {
        SetPropertyValue("Application_T", ref _application_T, value);
      }
    }

    private XPCollection<Application_T> availableApplications;
    [Browsable(false)]
    public XPCollection<Application_T> AvailableApplications
    {
        get
        {
            if (availableApplications == null)
            {
                availableApplications = new XPCollection<Application_T>(Session);

                string userName = ((AuthenticationStandardLogonParameters)SecuritySystem.LogonParameters).UserName;
                CriteriaOperator criteria = CriteriaOperator.Parse("UserName = '" + userName + "'");
                AriaSecuritySystemUser user = Session.FindObject<AriaSecuritySystemUser>(criteria);
                if (user.Account.Id.ToString().ToUpper() == "ARIA")
                {
                    return availableApplications;
                }
                else
                {
                    string str = string.Empty;
                    user.Account.ConfigurationItems.Load();
                    CriteriaOperator criteriaApp = null;
                    if (user.Account.ConfigurationItems.Count > 0)
                    {
                        for (int i = 0; i < user.Account.ConfigurationItems.Count; i++)
                        {
                            if (i > 0)
                            {
                                str += " OR ";
                            }
                            str = "[Oid] = '" + user.Account.ConfigurationItems[i].Application.Oid + "'";
                            
                            for (int j=0; j< user.Account.ConfigurationItems[i].PreRequesiteAppList.Count; j++)
                            {                                
                                if(!str.Contains(user.Account.ConfigurationItems[i].PreRequesiteAppList[j].Oid.ToString()))
                                {
                                    str += " OR ";
                                    str += "[Oid] = '" + user.Account.ConfigurationItems[i].PreRequesiteAppList[j].Oid + "'";
                                }
                            }
                        }
                        criteriaApp = CriteriaOperator.Parse(str);
                    }
                    else
                    {
                        criteriaApp = CriteriaOperator.Parse("[Oid] = '" + Guid.Empty + "'");
                    }
                    availableApplications.Criteria = criteriaApp;

                    return availableApplications;
                }
            }
            return availableApplications;
        }
    }
    [DevExpress.Xpo.AssociationAttribute("EntityOperationPermissions-AriaSecuritySystemRole")]
    public Aria5SystemAdmin.Module.BusinessObjects.AriaSecuritySystemRole AriaSecuritySystemRole
    {
      get
      {
        return _ariaSecuritySystemRole;
      }
      set
      {
        SetPropertyValue("AriaSecuritySystemRole", ref _ariaSecuritySystemRole, value);
      }
    }
  }
}

//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using DevExpress.ExpressApp.DC;
using DevExpress.Persistent.Base;
using DevExpress.Persistent.BaseImpl;
using DevExpress.Xpo;
using DevExpress.ExpressApp.ConditionalAppearance;
namespace Aria5SystemAdmin.Module.BusinessObjects
{
  // [Appearance("UseCasePoints", AppearanceItemType = "ViewItem", TargetItems = "UseCasePoints", Criteria = "UseCasePoints!=null", Context = "DetailView", Enabled = false)]
  [DefaultClassOptions]
  [RelatedEntity("Aria5-SystemAdmin-QAWBS")]
  [Appearance("Action", AppearanceItemType = "Action", TargetItems = "CreateWBSPhase", Criteria = "AutoTaskID > 0", Context = "DetailView", Enabled = false)]

  [XafDefaultProperty("Month")]
  public partial class QAWBS : DevExpress.Persistent.BaseImpl.BaseObject
  {
    private System.Int32 _month;
    private Aria5SystemAdmin.Module.BusinessObjects.QAUseCasePoints _useCasePoints;
    // private Aria5SystemAdmin.Module.BusinessObjects.ProjectTemplate _projectTemplate;
    private System.Int32 _resAvaHrsTot;
    private System.Int32 _estTrgCapIndTot;
    private System.Int32 _estCurCapIndTot;
    private System.Int32 _avgEstValTot;
    private System.Int32 _mEffort;
    private System.Int32 _mSharing;
    private System.Int32 _projEfrt;
  //ATA
    private System.Boolean _iscompleted;
      private System.Int32 _autotaskestimation;
    private System.Double _autotaskactual;
    //ATA
      public QAWBS(DevExpress.Xpo.Session session)
      : base(session)
    {
    }
    // Sara.N, Customize Clonning of usecase Points [Start]
    public QAWBS(DevExpress.Xpo.Session session,QAWBS WBS)
        : base(session)
    {
        this.AvgEstValTot = WBS.AvgEstValTot;
        this.EstCurCapIndTot = WBS.EstCurCapIndTot;
        this.EstTrgCapIndTot = WBS.EstTrgCapIndTot;
        this.MEffort = WBS.MEffort;
        this.Month = WBS.Month;
        this.MSharing = WBS.MSharing;
        //this.ProjEfrt = WBS.ProjEfrt;
        foreach (var item in WBS.QAActivities.ToList())
        {
            this.QAActivities.Add(new QAActivity(session, item));
            
        }
      
        this.ResAvaHrsTot = WBS.ResAvaHrsTot;
        //this.UseCasePoints = WBS.UseCasePoints;

    }
    // Sara.N, Customize Clonning of usecase Points [End]
    [DevExpress.Persistent.Base.ImmediatePostDataAttribute]
    public System.Int32 Month
    {
        get
        {
            return _month;
        }
        set
        {
            SetPropertyValue("Month", ref _month, value);
        }
    }

     //ATA add new field to enable set the wbs phase 
    private string _phaseTitle;

    public string PhaseTitle
    {
        get { return _phaseTitle; }
        set { SetPropertyValue("PhaseTitle", ref _phaseTitle, value); }
    }
    //ATA add new field to enable set the wbs phase 

    //[DataSourceProperty("UseCasePoints.ProjectEfforts")]
    public System.Int32 ProjEfrt
    {
        get
        {
            
            return _projEfrt;
        }
        set
        {
            //if (this.UseCasePoints.ProjectEfforts > 0)
            //{
            //    _projEfrt = this.UseCasePoints.ProjectEfforts;
            //}
            SetPropertyValue("ProjEfrt", ref _projEfrt, value);
        }
    }
    public System.Int32 MSharing
    {
        get
        {
            //  if (Month == 0 && _mSharing == 0)
            //  _mSharing = 15;
            //else
            //  if (Month == 1 &&_mSharing == 0)
            //    _mSharing = 15;
            //  else
            //      if (Month == 2 && _mSharing == 0)
            //      _mSharing = 25;
            //    else
            //          if (Month == 3 && _mSharing == 0)
            //        _mSharing = 45;
            //        else if (_mSharing == 0)
            //          _mSharing = 0;
            return _mSharing;
        }
        set
        {
            SetPropertyValue("MSharing", ref _mSharing, value);
        }
    }
    public System.Int32 MEffort
    {
        get
        { //ATA
            _mEffort = (MSharing * ProjEfrt) / 100; // when create Task gives error of 
            //ATA
            return _mEffort;
        }
        set
        {
            SetPropertyValue("MEffort", ref _mEffort, value);
        }
    }
    [DevExpress.ExpressApp.DC.XafDisplayNameAttribute("Avg. Est. Val. Tot.")]
    public System.Int32 AvgEstValTot
    {
        get
        {
            return _avgEstValTot;
        }
        set
        {
            SetPropertyValue("AvgEstValTot", ref _avgEstValTot, value);
        }
    }
    public System.Int32 EstCurCapIndTot
    {
        get
        {
            return _estCurCapIndTot;
        }
        set
        {
            SetPropertyValue("EstCurCapIndTot", ref _estCurCapIndTot, value);
        }
    }
    public System.Int32 EstTrgCapIndTot
    {
        get
        {
            return _estTrgCapIndTot;
        }
        set
        {
            SetPropertyValue("EstTrgCapIndTot", ref _estTrgCapIndTot, value);
        }
    }
    public System.Int32 ResAvaHrsTot
    {
        get
        {
            return _resAvaHrsTot;
        }
        set
        {
            SetPropertyValue("ResAvaHrsTot", ref _resAvaHrsTot, value);
        }
    }
    //[DevExpress.Xpo.AssociationAttribute("QAWBSs-ProjectTemplate")]
    //public Aria5SystemAdmin.Module.BusinessObjects.ProjectTemplate ProjectTemplate
    //{
    //  get
    //  {
    //    return _projectTemplate;
    //  }
    //  set
    //  {
    //    SetPropertyValue("ProjectTemplate", ref _projectTemplate, value);
    //  }
    //}
    [DevExpress.Xpo.AssociationAttribute("QAActivities-QAWBS")]
    public XPCollection<Aria5SystemAdmin.Module.BusinessObjects.QAActivity> QAActivities
    {
        get
        {
            return GetCollection<Aria5SystemAdmin.Module.BusinessObjects.QAActivity>("QAActivities");
        }
    }
    [DevExpress.Xpo.AssociationAttribute("WBS-UseCasePoints")]
    public Aria5SystemAdmin.Module.BusinessObjects.QAUseCasePoints UseCasePoints
    {
        get
        {
           
            return _useCasePoints;
        }
        set
        {
            SetPropertyValue("UseCasePoints", ref _useCasePoints, value);
            //ATA
            //if (this.UseCasePoints != null && this.UseCasePoints.ProjectEfforts > 0)
            //{
            //_projEfrt = this.UseCasePoints.ProjectEfforts;
            //}

            //ATA
            if (!IsSaving && !IsLoading && value != null && value.Project != null && Project != value.Project)
            {
                Project = value.Project;
            }
        }
    }
    private System.Int64 _AutoTaskID;
    public System.Int64 AutoTaskID
    {
        get
        {
            return _AutoTaskID;
        }
        set
        {
            SetPropertyValue("AutoTaskID", ref _AutoTaskID, value);
        }
    }
      //ATA
    public System.Int32 Autotaskestimaiton
    {
        get { return _autotaskestimation; }
        set
        {
            SetPropertyValue("Autotaskestimation", ref _autotaskestimation, value);
        }
    }
    public System.Double Autotaskactual
    {
        get { return _autotaskactual; }
        set
        {
            SetPropertyValue("Autotaskactual", ref _autotaskactual, value);
        }
    }
    public System.Boolean Iscompleted
    {
        get { return _iscompleted; }
        set
        {
            SetPropertyValue("Iscompleted", ref _iscompleted, value);
        }
    }
      //ATA
      //ATA add relation to the phase with it's project and start date and end date for the specific phase 
    private ProjectTemplate _project;
      [Association("Project-Phases")]
    public ProjectTemplate Project
    {
        get { return _project; }
        set 
        {
            SetPropertyValue("Project", ref _project, value);
            if (IsSaving  && value != null && StartDate == DateTime.MinValue)
            {
                if (Month > 0 && Month < 4)
                {
                    StartDate = CalcEndate.CalcEnddate(value.StartDate, Month);
                    EndDate = CalcEndate.CalcEnddate(StartDate, 1).AddDays(-3);
                }
                else if (Month == 0)
                {
                    StartDate = value.StartDate;
                    EndDate = CalcEndate.CalcEnddate(StartDate, 1).AddDays(-3);
                }
                if (value.UseCasePoints != null && UseCasePoints != value.UseCasePoints)
                {
                    UseCasePoints = value.UseCasePoints;
                }
                //ATA 9/26/2017 
                if (this.Project != null && this.Project.UseCasePoints != null)
                {
                    ProjEfrt = this.Project.UseCasePoints.ProjectEfforts;
                }
                //else if (this.Project != null && this.Project.UseCasePoints == null && this.Project.ProjectReference != null && this.Project.ProjectReference.UseCasePoints != null)
                //{
                //    ProjEfrt = this.Project.ProjectReference.UseCasePoints.ProjectEfforts;
                //}
                else
                {
                    ProjEfrt = 0;
                }
                //_projEfrt = this.UseCasePoints.ProjectEfforts;
            }
        }
    }
      private DateTime _startDate;
      public DateTime StartDate
      {
          get
          {
              return _startDate;
          }
          set
          {
              SetPropertyValue("StartDate", ref _startDate, value);
          }
      }
      private DateTime _EndDate;
      public DateTime EndDate
      {
          get
          {
              return _EndDate;
          }
          set
          {
              SetPropertyValue("EndDate", ref _EndDate, value);
          }
      }
      //ATA add relation to the phase with it's project 

  }
}
